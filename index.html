<html lang="ar" dir="rtl"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImI4Y2EzODU1OTU1ZmQ1MTMxOGFmNzI2ZTM0YzZjYWUzZmYyYWY4N2YiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwOTU1NDM5MzQ1MjExNjkwNzQ3NiIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjXzM0YzM5YjZjNmY4NjY0YTlfc3R1ZGVudF9ldmFsdWF0aW9uX2FwcC5odG1sLTExMCJ9LCJleHAiOjE3NjI1ODg2NTQsImlhdCI6MTc2MjU4NTA1NCwiYWxnIjoiUlMyNTYifQ.BgclhqxhGu4U0FvjGCPqkD0gfAl9ckgMskNemwBkEfiX1jj5avTfc149nQuwTFO-4AvCATQIxIMfDFxcwFjvMI3zTCzll-5rcTcpqwMfMnlfvZ_E667nlUqYHnXmItqngyi61xBY5uysi2EDzVYf2An_hMPI6hil13iKyAJE6_yfRkQAJjB1wN0KX-ELcg6R51FdzbE5T6nBqQqpQBzopZD4eaO46fQWJ1aWK51d8jgNXfs-pXPpfFycvBCC6KuRtTG7rmUIfMmdKJ5o4_X9o2L1JU6nC1Rjk-SSZha0dG09p40jm8yhgeykGpiZBF0QBTlvYbgaOYlEP8CrAEeqTw","c_34c39b6c6f8664a9_student_evaluation_app.html-110")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function p(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var e=a[c];if(!(e in d))break a;d=d[e]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function f(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(f,e)}f(a.next())})}function t(a){return r(a())}
p("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});p("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var e=c.length;d=d||0;for(d<0&&(d=Math.max(d+e,0));d<e;d++){var f=c[d];if(f===b||Object.is(f,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(e=>{d[e]=c[e]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}let x=null;function y(a={}){return x?x:a.l?x=a.l:x=w(window.getComputedStyle(document.documentElement))}function z(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function A(a,b={}){var d;if(!(d=b.width)){d=z(a,"border-left-width");var c=z(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=z(a,"border-top-width"),c=z(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function B(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function C(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function D(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);e.setAttribute("width","100%");e.setAttribute("height","100%");e.setAttribute("x","0");e.setAttribute("y","0");e.setAttribute("externalResourcesRequired","true");c.appendChild(e);e.appendChild(a);return C(c)})}
var E=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||E(a,b)};function F(a,b){return y(b).map(d=>{const c=a.getPropertyValue(d),e=a.getPropertyPriority(d);return`${d}: ${c}${e?" !important":""};`}).join(" ")}
function G(a,b,d,c){a=window.getComputedStyle(a,d);var e=a.getPropertyValue("content");if(e!==""&&e!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(k){return}e=document.createElement("style");var g=e.appendChild;d=`.${f}:${d}`;a.cssText?(c=a.getPropertyValue("content"),c=`${a.cssText} content: '${c.replace(/'|"/g,"")}';`):c=F(a,c);g.call(e,document.createTextNode(`${d}{${c}}`));b.appendChild(e)}};function H(a){return a.search(/^(data:)/)!==-1}function I(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const e=yield c.blob();return new Promise((f,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{f(d({o:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(e)})})}const J={};function K(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function L(a,b,d){return t(function*(){const c=K(a,b,d.C);if(J[c]!=null)return J[c];d.u&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let e;try{const f=yield I(a,d.i,({o:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});e=`data:${b};base64,${f}`}catch(f){e=d.B||""}return J[c]=e})};const M={P:"application/font-woff",R:"application/font-woff",N:"application/font-truetype",v:"application/vnd.ms-fontobject",H:"image/png",F:"image/jpeg",D:"image/jpeg",A:"image/gif",M:"image/tiff",L:"image/svg+xml",O:"image/webp"};function N(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function O(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):B(b)})}function aa(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return B(d)}d=a.poster;d=yield L(d,M[N(d).toLowerCase()]||"",b);return B(d)})}
function ba(a,b){return t(function*(){try{let d;if(a==null?0:(d=a.contentDocument)==null?0:d.body)return yield P(a.contentDocument.body,b,!0)}catch(d){}return a.cloneNode(!1)})}function ca(a,b){return t(function*(){return E(a,HTMLCanvasElement)?O(a):E(a,HTMLVideoElement)?aa(a,b):E(a,HTMLIFrameElement)?ba(a,b):a.cloneNode(a.tagName!=null&&a.tagName.toUpperCase()==="SVG")})}
function da(a,b,d){return t(function*(){if(b.tagName!=null&&b.tagName.toUpperCase()==="SVG")return b;let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let e;if(E(a,HTMLIFrameElement)&&((e=a.contentDocument)==null?0:e.body))c=w(a.contentDocument.body.childNodes);else{let f;c=w(((f=a.shadowRoot)!=null?f:a).childNodes)}}if(c.length===0||E(a,HTMLVideoElement))return b;yield c.reduce((e,f)=>e.then(()=>P(f,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());
return b})}function ea(a,b,d){const c=b.style;if(c){var e=window.getComputedStyle(a);e.cssText?(c.cssText=e.cssText,c.transformOrigin=e.transformOrigin):y(d).forEach(f=>{let g=e.getPropertyValue(f);f==="font-size"&&g.endsWith("px")&&(g=`${Math.floor(parseFloat(g.substring(0,g.length-2)))-.1}px`);E(a,HTMLIFrameElement)&&f==="display"&&g==="inline"&&(g="block");f==="d"&&b.getAttribute("d")&&(g=`path(${b.getAttribute("d")})`);c.setProperty(f,g,e.getPropertyPriority(f))})}}
function fa(a,b){E(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ha(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var e=0;e<d.length;e++){var f=d[e].getAttribute("xlink:href");if(f){const g=document.querySelector(f);a.querySelector(f)||!g||c[f]||(c[f]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";e=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(e);for(f=0;f<d.length;f++)e.appendChild(d[f]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>ca(c,b)).then(c=>da(a,c,b)).then(c=>{E(c,Element)&&(ea(a,c,b),G(a,c,":before",b),G(a,c,":after",b),E(a,HTMLTextAreaElement)&&(c.textContent=a.value),E(a,HTMLInputElement)&&c.setAttribute("value",a.value),fa(a,c));return c}).then(c=>ha(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,ia=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ja=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ka(a){const b=[];a.replace(Q,(d,c,e)=>{b.push(e);return d});return b.filter(d=>!H(d))}
function la(a,b,d,c){return t(function*(){try{const e=d?(new URL(b,d||void 0)).toString():b;let f;f=yield L(e,M[N(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${f}$3`)}catch(e){}return a})}function ma(a,{I:b}){return b?a.replace(ja,d=>{for(;;){const [c,,e]=ia.exec(d)||[],f=c,g=e;if(!g)return"";if(g===b)return`src: ${f};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ma(a,d);return ka(c).reduce((e,f)=>e.then(g=>la(g,f,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const e=(c=b.style)==null?void 0:c.getPropertyValue(a);return e?(c=yield R(e,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function na(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("-webkit-mask",a,b))||(yield S("mask-image",a,b))||(yield S("-webkit-mask-image",a,b))})}
function oa(a,b){return t(function*(){const d=E(a,HTMLImageElement);if(d&&!H(a.src)||E(a,SVGImageElement)&&!H(a.href.baseVal)){var c=d?a.src:a.href.baseVal,e=yield L(c,M[N(c).toLowerCase()]||"",b);yield new Promise((f,g)=>{a.onload=f;a.onerror=b.m?(...k)=>{try{f(b.m(...k))}catch(m){g(m)}}:g;a.decode&&(a.decode=f);a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=e):a.href.baseVal=e})}})}
function pa(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){E(a,Element)&&(yield na(a,b),yield oa(a,b),yield pa(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,e=(d.match(/url\([^)]+\)/g)||[]).map(f=>t(function*(){let g=f.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return I(g,b.i,({result:k})=>{d=d.replace(f,`url(${k})`);return[f,k]})}));return Promise.all(e).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let e=d.exec(a);if(e===null)if(e=c.exec(a),e===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(e[0])}return b}
function qa(a,b){return t(function*(){const d=[],c=[];a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach((f,g)=>{if(f.type===CSSRule.IMPORT_RULE){let k=g+1;f=V(f.href).then(m=>W(m,b)).then(m=>X(m).forEach(q=>{try{e.insertRule(q,q.startsWith("@import")?k+=1:e.cssRules.length)}catch(Da){}})).catch(()=>{});c.push(f)}})}catch(f){const g=a.find(k=>k.href==null)||document.styleSheets[0];e.href!=null&&c.push(V(e.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,g.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(e=>{if("cssRules"in e)try{w(e.cssRules||[]).forEach(f=>{d.push(f)})}catch(f){}});return d})})}function ra(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function sa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield qa(d,b);return ra(d)})}
function ta(a){function b(c){(c.style.fontFamily||getComputedStyle(c).fontFamily).split(",").forEach(e=>{d.add(e.trim().replace(/["']/g,""))});Array.from(c.children).forEach(e=>{e instanceof HTMLElement&&b(e)})}const d=new Set;b(a);return d}function ua(a,b){return t(function*(){const d=yield sa(a,b),c=ta(a);return(yield Promise.all(d.filter(e=>c.has(e.style.fontFamily.trim().replace(/["']/g,""))).map(e=>R(e.cssText,e.parentStyleSheet?e.parentStyleSheet.href:null,b)))).join("\n")})}
function va(a,b){return t(function*(){const d=b.j!=null?b.j:b.K?null:yield ua(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function wa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b),e=yield P(a,b,!0);yield va(e,b);yield T(e,b);u(e,b);return yield D(e,d,c)})}
function xa(a,b={}){return t(function*(){const {width:d,height:c}=A(a,b);var e=yield wa(a,b);e=yield B(e);const f=document.createElement("canvas"),g=f.getContext("2d"),k=b.G||window.devicePixelRatio||1,m=b.h||d,q=b.g||c;f.width=m*k;f.height=q*k;!b.J&&(f.width>16384||f.height>16384)&&(f.width>16384&&f.height>16384?f.width>f.height?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=16384):f.width>16384?(f.height*=16384/f.width,f.width=16384):(f.width*=16384/f.height,f.height=
16384));f.style.width=`${m}`;f.style.height=`${q}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,f.width,f.height));g.drawImage(e,0,0,f.width,f.height);return f})}function ya(a,b={}){return t(function*(){return(yield xa(a,b)).toDataURL()})};const za=["gemini.google.com","corp.google.com","proxy.googlers.com"];function Y(){return document.body.querySelectorAll('[class*="animate"]').length>0}function Z(a){return t(function*(){try{return yield ya(a,{h:a.offsetWidth,g:a.offsetHeight})}catch(d){var b=a.offsetHeight;const c=document.createElement("canvas");c.width=a.offsetWidth;c.height=b;return c.toDataURL("image/png")}})}
function Aa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(e=>e.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function Ba(a){return t(function*(){let b=document.body;if(Y()){var d=yield Aa();b=d;document.body.appendChild(d)}d=yield Z(b);Y()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}function Ca(a){return t(function*(){const b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Z(document.body),topOffset:0};window.parent.postMessage(b,a.origin)})}
window.addEventListener("message",a=>t(function*(){if(za.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield Ba(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield Ca(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });
  modelInformation.deprecatedImageModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predict',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':predictLongRunning',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-09-2025","imageModelName":"imagen-4.0-generate-001","imageEditModelName":"gemini-2.5-flash-image-preview","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17","gemini-2.5-flash-preview-05-20"],"deprecatedImageModelNames":["imagen-3.0-generate-001","imagen-3.0-generate-002"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق تسجيل وتقييم الطلاب (نظام محلي)</title>
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- تحميل مكتبات تصدير PDF -->
    <!-- jsPDF: لإنشاء ملف PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    <!-- html2canvas: لتحويل جزء من الصفحة إلى صورة -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
    
    <!-- خط Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Cairo:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', 'Inter', sans-serif;
            background-color: #f4f7f6; /* لون خلفية ناعم */
        }
        
        /* إخفاء العناصر */
        .hidden {
            display: none;
        }

        /* أزرار التقييم عند اختيارها */
        .rating-button.selected {
            background-color: #10B981; /* أخضر زمردي */
            color: white;
            border-color: #10B981;
        }

        /* تنسيق جميل للـ Modal */
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
            max-height: 90vh; /* تحديد أقصى ارتفاع */
        }

        /* تنسيق الصفحة المخصصة للطباعة (داخل المودال) */
        .pdf-page {
            width: 210mm; /* عرض A4 */
            min-height: 297mm; /* ارتفاع A4 */
            padding: 20mm;
            margin: 1rem auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            direction: rtl; /* ضمان الاتجاه الصحيح داخل الـ PDF */
            color: #000; /* لون الخط أسود للطباعة */
        }

        /* إخفاء الأزرار عند الطباعة (لـ html2canvas) */
        .no-print {
            display: block; /* يظهر عادي */
        }
        .pdf-page .no-print {
            display: none; /* يختفي عند العرض داخل صفحة الـ PDF */
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.fixed{position:fixed}.inset-0{inset:0px}.z-40{z-index:40}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:0.25rem}.mt-12{margin-top:3rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-12{height:3rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-auto{height:auto}.min-h-screen{min-height:100vh}.w-12{width:3rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-full{width:100%}.max-w-4xl{max-width:56rem}.max-w-5xl{max-width:64rem}.max-w-full{max-width:100%}.max-w-md{max-width:28rem}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.border-collapse{border-collapse:collapse}.scale-95{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-4{gap:1rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-x-reverse > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:1}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-2{border-width:2px}.border-t{border-top-width:1px}.border-t-2{border-top-width:2px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-gray-400{--tw-border-opacity:1;border-color:rgb(156 163 175 / var(--tw-border-opacity, 1))}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}.bg-gray-200{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}.bg-gray-500{--tw-bg-opacity:1;background-color:rgb(107 114 128 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-green-600{--tw-bg-opacity:1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-indigo-600{--tw-bg-opacity:1;background-color:rgb(79 70 229 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-opacity-75{--tw-bg-opacity:0.75}.bg-gradient-to-br{background-image:linear-gradient(to bottom right, var(--tw-gradient-stops))}.from-gray-50{--tw-gradient-from:#f9fafb var(--tw-gradient-from-position);--tw-gradient-to:rgb(249 250 251 / 0) var(--tw-gradient-to-position);--tw-gradient-stops:var(--tw-gradient-from), var(--tw-gradient-to)}.to-blue-100{--tw-gradient-to:#dbeafe var(--tw-gradient-to-position)}.p-2{padding:0.5rem}.p-3{padding:0.75rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pt-4{padding-top:1rem}.pt-6{padding-top:1.5rem}.pt-8{padding-top:2rem}.text-center{text-align:center}.text-right{text-align:right}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.shadow-2xl{--tw-shadow:0 25px 50px -12px rgb(0 0 0 / 0.25);--tw-shadow-colored:0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-300{transition-duration:300ms}.ease-in-out{transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1)}.file\:mr-4::file-selector-button{margin-right:1rem}.file\:rounded-full::file-selector-button{border-radius:9999px}.file\:border-0::file-selector-button{border-width:0px}.file\:bg-blue-50::file-selector-button{--tw-bg-opacity:1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.file\:px-4::file-selector-button{padding-left:1rem;padding-right:1rem}.file\:py-2::file-selector-button{padding-top:0.5rem;padding-bottom:0.5rem}.file\:text-sm::file-selector-button{font-size:0.875rem;line-height:1.25rem}.file\:font-semibold::file-selector-button{font-weight:600}.file\:text-blue-700::file-selector-button{--tw-text-opacity:1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.hover\:scale-105:hover{--tw-scale-x:1.05;--tw-scale-y:1.05;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-200:hover{--tw-bg-opacity:1;background-color:rgb(229 231 235 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-green-700:hover{--tw-bg-opacity:1;background-color:rgb(21 128 61 / var(--tw-bg-opacity, 1))}.hover\:bg-indigo-700:hover{--tw-bg-opacity:1;background-color:rgb(67 56 202 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:text-gray-900:hover{--tw-text-opacity:1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.hover\:file\:bg-blue-100::file-selector-button:hover{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246 / var(--tw-ring-opacity, 1))}.focus\:ring-green-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(34 197 94 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:p-6{padding:1.5rem}}@media (min-width: 768px){.md\:mb-0{margin-bottom:0px}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.md\:flex-row{flex-direction:row}.md\:p-8{padding:2rem}}</style></head>
<body class="bg-gradient-to-br from-gray-50 to-blue-100 min-h-screen">

    <!-- حاوية التطبيق الرئيسية -->
    <div class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">

        <!-- زر الإعدادات في الأعلى -->
        <header class="flex justify-between items-center mb-6">
            <h1 id="appTitle" class="text-3xl font-bold text-gray-800">تطبيق تقييم الطلاب</h1>
            <button id="settingsButton" class="p-2 rounded-full text-gray-600 hover:bg-gray-200 hover:text-gray-900 transition-colors hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.573-1.066z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
        </header>

        <!-- (1) شاشة القائمة الرئيسية -->
        <div id="mainMenuScreen" class="bg-white p-8 rounded-2xl shadow-xl space-y-6 text-center hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-6">القائمة الرئيسية</h2>
            <button id="goToRegistrationButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105">
                تسجيل طالب جديد
            </button>
            <button id="goToPasswordButton" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105">
                تقييم الطلاب
            </button>
        </div>

        <!-- (2) شاشة تسجيل طالب -->
        <div id="registrationScreen" class="bg-white p-8 rounded-2xl shadow-xl hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-6">تسجيل طالب جديد</h2>
            <form id="registrationForm" class="space-y-4">
                <input id="studentName" type="text" placeholder="اسم الطالب كاملاً" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <select id="studentClass" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                        <option value="">اختر الصف...</option>
                        <option value="1">الصف الأول</option>
                        <option value="2">الصف الثاني</option>
                        <option value="3">الصف الثالث</option>
                        <option value="4">الصف الرابع</option>
                        <option value="5">الصف الخامس</option>
                        <option value="6">الصف السادس</option>
                    </select>
                    <select id="studentSection" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                        <option value="">اختر الشعبة...</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                    <select id="studentDepartment" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                        <option value="">اختر القسم...</option>
                        <option value="عام">عام</option>
                        <option value="تحفيظ">تحفيظ</option>
                        <option value="دبلومة">دبلومة</option>
                    </select>
                </div>
                
                <input id="studentGroup" type="text" placeholder="مجموعة المربي المخلص" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                <input id="broadcastDate" type="date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                        سجل الطالب الآن
                    </button>
                    <button type="button" class="backButton bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                        رجوع
                    </button>
                </div>
            </form>
        </div>

        <!-- (3) شاشة إدخال كلمة المرور -->
        <div id="passwordScreen" class="bg-white p-8 rounded-2xl shadow-xl max-w-md mx-auto hidden">
            <h2 class="text-2xl font-bold text-gray-700 mb-6 text-center">الدخول لوحدة التقييم</h2>
            <form id="passwordForm" class="space-y-4">
                <input id="passwordInput" type="password" placeholder="أدخل كلمة المرور (123)" class="w-full p-3 text-center border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" required="">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                        دخول
                    </button>
                    <button type="button" class="backButton bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                        رجوع
                    </button>
                </div>
            </form>
        </div>

        <!-- (4) شاشة قائمة الطلاب للتقييم -->
        <div id="evaluationListScreen" class="bg-white p-8 rounded-2xl shadow-xl hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-700">قائمة الطلاب</h2>
                <button id="exportAllStudentsButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all flex items-center space-x-2 space-x-reverse">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 01-1.447.894L10 14.586l-4.553 2.308A1 1 0 014 16V4z" clip-rule="evenodd"></path>
                    </svg>
                    <span>تصدير نتائج كل الطلاب</span>
                </button>
            </div>
            
            <div id="studentListContainer" class="space-y-3"><div class="flex flex-col md:flex-row items-center justify-between bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200">
                    <div class="mb-4 md:mb-0">
                        <p class="text-lg font-bold text-gray-800">محمد</p>
                        <p class="text-sm text-gray-600">
                            الصف: 1 / 1 - القسم: عام
                        </p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button data-id="3a0107db-8983-4f59-ab0a-28deacd3fbcb" class="evalButton flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all">
                            تقييم
                        </button>
                        <button data-id="3a0107db-8983-4f59-ab0a-28deacd3fbcb" class="exportPdfButton flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all">
                            PDF
                        </button>
                        <button data-id="3a0107db-8983-4f59-ab0a-28deacd3fbcb" class="deleteButton flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all">
                            حذف
                        </button>
                    </div>
                </div></div>
            <button type="button" class="backButton mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                رجوع للقائمة
            </button>
        </div>

        <!-- (5) شاشة التقييم التفصيلي -->
        <div id="ratingScreen" class="hidden bg-white p-8 rounded-2xl shadow-xl space-y-6">
            <h2 class="text-2xl font-bold text-gray-700">تقييم الطالب: <span id="ratingStudentName" class="text-blue-600"></span></h2>
            
            <!-- اختيار المقيم -->
            <div>
                <label for="evaluatorSelect" class="block text-lg font-semibold text-gray-700 mb-2">اختر اسم المقيّم:</label>
                <select id="evaluatorSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required="">
                    <option value="">-- اختر اسمك --</option>
                    <option value="محمد مفرح العتيبي">محمد مفرح العتيبي</option>
                    <option value="فهد الطوياوي">فهد الطوياوي</option>
                    <option value="منتصر محمد">منتصر محمد</option>
                </select>
            </div>

            <!-- نموذج التقييم -->
            <form id="ratingForm" class="hidden space-y-6">
                <!-- المعيار 1 -->
                <div class="p-4 border border-gray-200 rounded-lg">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">1. الإعداد الجيد</label>
                    <div class="flex flex-wrap gap-2" data-criteria="prep">
                        <button type="button" data-value="5" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ممتاز (5)</button>
                        <button type="button" data-value="4" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد جداً (4)</button>
                        <button type="button" data-value="3" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد (3)</button>
                        <button type="button" data-value="2" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">مقبول (2)</button>
                        <button type="button" data-value="1" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ضعيف (1)</button>
                    </div>
                    <input type="hidden" id="prepScore" name="prepScore" required="">
                </div>
                <!-- المعيار 2 -->
                <div class="p-4 border border-gray-200 rounded-lg">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">2. التنوع</label>
                    <div class="flex flex-wrap gap-2" data-criteria="diversity">
                        <button type="button" data-value="5" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ممتاز (5)</button>
                        <button type="button" data-value="4" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد جداً (4)</button>
                        <button type="button" data-value="3" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد (3)</button>
                        <button type="button" data-value="2" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">مقبول (2)</button>
                        <button type="button" data-value="1" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ضعيف (1)</button>
                    </div>
                    <input type="hidden" id="diversityScore" name="diversityScore" required="">
                </div>
                <!-- المعيار 3 -->
                <div class="p-4 border border-gray-200 rounded-lg">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">3. وضوح الرسالة الموجهة</label>
                    <div class="flex flex-wrap gap-2" data-criteria="clarity">
                        <button type="button" data-value="5" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ممتاز (5)</button>
                        <button type="button" data-value="4" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد جداً (4)</button>
                        <button type="button" data-value="3" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد (3)</button>
                        <button type="button" data-value="2" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">مقبول (2)</button>
                        <button type="button" data-value="1" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ضعيف (1)</button>
                    </div>
                    <input type="hidden" id="clarityScore" name="clarityScore" required="">
                </div>
                <!-- المعيار 4 -->
                <div class="p-4 border border-gray-200 rounded-lg">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">4. جودة الإلقاء</label>
                    <div class="flex flex-wrap gap-2" data-criteria="delivery">
                        <button type="button" data-value="5" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ممتاز (5)</button>
                        <button type="button" data-value="4" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد جداً (4)</button>
                        <button type="button" data-value="3" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">جيد (3)</button>
                        <button type="button" data-value="2" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">مقبول (2)</button>
                        <button type="button" data-value="1" class="rating-button flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg border-2 border-gray-200 transition-all">ضعيف (1)</button>
                    </div>
                    <input type="hidden" id="deliveryScore" name="deliveryScore" required="">
                </div>

                <!-- أزرار الحفظ والرجوع -->
                <div class="flex items-center space-x-4 space-x-reverse pt-4">
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                        حفظ التقييم
                    </button>
                    <button type="button" id="backToListButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                        الرجوع للقائمة
                    </button>
                </div>
            </form>

            <!-- سجل التقييمات السابقة -->
            <div id="evaluationHistory" class="pt-6 border-t border-gray-200">
                <h3 class="text-xl font-bold text-gray-700 mb-4">سجل التقييمات لهذا الطالب</h3>
                <div id="historyTableContainer" class="overflow-x-auto">
                    <!-- سيتم ملء الجدول هنا -->
                </div>
            </div>
        </div>

        <!-- (6) شاشة الإعدادات -->
        <div id="settingsScreen" class="bg-white p-8 rounded-2xl shadow-xl space-y-6">
            <h2 class="text-2xl font-bold text-gray-700 mb-6">الإعدادات</h2>

            <!-- إعدادات نموذج PDF -->
            <div class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">تخصيص نموذج PDF</h3>
                <div class="space-y-4">
                    <div>
                        <label for="settingsPdfImage" class="block text-sm font-medium text-gray-700">رفع صورة (شعار/ترويسة للـ PDF)</label>
                        <input type="file" id="settingsPdfImage" accept="image/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        <img id="settingsImagePreview" src="https://placehold.co/600x150/EEE/CCC?text=Preview" alt="معاينة الصورة" class="mt-4 w-full rounded-lg border border-gray-300">
                    </div>
                    <div>
                        <label for="settingsCommitteeTitle" class="block text-sm font-medium text-gray-700">تعديل عنوان "لجنة التقييم"</label>
                        <input type="text" id="settingsCommitteeTitle" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- إعدادات التطبيق (تظهر فقط عند الدخول من التقييم) -->
            <div id="appSettingsSection" class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">إعدادات التطبيق</h3>
                <p class="text-sm text-gray-600 mb-4">قم بتصدير التطبيق بالكامل كملف HTML واحد ليعمل بشكل محلي على جهازك دون الحاجة للإنترنت.</p>
                <button id="exportAppButton" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    تصدير التطبيق كاملاً (HTML)
                </button>
            </div>
            
            <div class="flex items-center space-x-4 space-x-reverse pt-4">
                <button id="saveSettingsButton" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    حفظ الإعدادات
                </button>
                <button type="button" class="backButton bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    رجوع
                </button>
            </div>
        </div>

    </div> <!-- نهاية حاوية التطبيق -->

    <!-- (A) مودال الرسائل المنبثقة -->
    <div id="messageModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 modal opacity-0 hidden">
        <div class="modal-content bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95">
            <div id="messageIcon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4"><svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg></div>
            <p id="messageText" class="text-lg font-semibold text-gray-700">جاري إعداد ملف PDF، يرجى الانتظار...</p>
            <button id="closeMessageButton" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all">
                إغلاق
            </button>
        </div>
    </div>

    <!-- (B) مودال معاينة تصدير PDF (طالب واحد) -->
    <div id="pdfPreviewModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-40 modal opacity-0 hidden">
        <div class="modal-content bg-gray-100 p-4 sm:p-6 rounded-xl shadow-2xl max-w-4xl w-full text-center transform overflow-y-auto scale-95">
            
            <h3 class="text-2xl font-bold text-gray-800 mb-4">معاينة التصدير</h3>
            
            <!-- هذا العنصر هو الذي سيتم تحويله إلى PDF -->
            <div id="pdf-preview-content" class="pdf-page text-right">
                <!-- 1. الترويسة المخصصة (من الإعدادات) -->
                <div id="pdf-custom-header" class="mb-8">
                    <img id="pdf-header-image" src="" alt="" class="max-w-full h-auto mx-auto hidden">
                </div>

                <!-- 2. معلومات الطالب -->
                <div class="mb-8 text-center">
                    <h1 class="text-3xl font-bold mb-4" style="color: #000;">تقرير تقييم طالب</h1>
                    <p class="text-lg" style="color: #000;"><span class="font-semibold">التاريخ:</span> <span id="pdf-date">٨‏/١١‏/٢٠٢٥</span></p>
                </div>
                
                <div class="mb-8 p-4 bg-gray-50 rounded-lg border border-gray-200" style="background: #f9f9f9;">
                    <div class="grid grid-cols-2 gap-4 text-base">
                        <p style="color: #000;"><span class="font-semibold">اسم الطالب:</span> <span id="pdf-student-name">محمد</span></p>
                        <p style="color: #000;"><span class="font-semibold">القسم:</span> <span id="pdf-student-department">عام</span></p>
                        <p style="color: #000;"><span class="font-semibold">الصف/الشعبة:</span> <span id="pdf-student-class">الصف 1 / 1</span></p>
                        <p style="color: #000;"><span class="font-semibold">مجموعة المربي:</span> <span id="pdf-student-group">محمد</span></p>
                    </div>
                </div>

                <!-- 3. جدول التقييم (بناءً على المنطق المطلوب) -->
                <h2 class="text-2xl font-semibold mb-4" style="color: #000;">عناصر التقييم (النتيجة النهائية)</h2>
                <table class="w-full border-collapse border border-gray-400 text-base" style="color: #000;">
                    <thead class="bg-gray-200" style="background: #E5E7EB;">
                        <tr>
                            <th class="border border-gray-400 p-3 font-semibold">العنصر</th>
                            <th class="border border-gray-400 p-3 font-semibold">ممتاز (5)</th>
                            <th class="border border-gray-400 p-3 font-semibold">جيد جداً (4)</th>
                            <th class="border border-gray-400 p-3 font-semibold">جيد (3)</th>
                            <th class="border border-gray-400 p-3 font-semibold">مقبول (2)</th>
                            <th class="border border-gray-400 p-3 font-semibold">ضعيف (1)</th>
                        </tr>
                    </thead>
                    <tbody id="pdf-scores-table" class="bg-white"><tr><td class="border border-gray-400 p-3 font-semibold" style="color: #000;">الإعداد الجيد</td>
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    </tr><tr><td class="border border-gray-400 p-3 font-semibold" style="color: #000;">التنوع</td>
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    </tr><tr><td class="border border-gray-400 p-3 font-semibold" style="color: #000;">وضوح الرسالة الموجهة</td>
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    </tr><tr><td class="border border-gray-400 p-3 font-semibold" style="color: #000;">جودة الإلقاء</td>
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            
                        </td>
                    </tr></tbody>
                </table>

                <!-- 4. لجنة التقييم (من الإعدادات) -->
                <div class="mt-12 pt-8 border-t-2 border-gray-300">
                    <h2 id="pdf-committee-title" class="text-xl font-semibold mb-4" style="color: #000;">لجنة التقييم</h2>
                    <ul id="pdf-evaluators-list" class="list-disc list-inside text-base" style="color: #000;"><li style="color: #000;">لا توجد تقييمات مسجلة</li></ul>
                </div>
            </div>
            
            <!-- أزرار التحكم بالمودال -->
            <div class="mt-6 flex items-center space-x-4 space-x-reverse no-print">
                <button id="confirmPdfDownload" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    تأكيد التنزيل (PDF)
                </button>
                <button id="cancelPdfPreview" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- (C) مودال معاينة تصدير PDF (كل الطلاب) -->
    <div id="allStudentsPdfModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-40 opacity-0 modal">
        <div class="modal-content bg-gray-100 p-4 sm:p-6 rounded-xl shadow-2xl max-w-4xl w-full text-center transform scale-95 overflow-y-auto">
            
            <h3 class="text-2xl font-bold text-gray-800 mb-4">معاينة تصدير جميع الطلاب</h3>
            
            <!-- هذا العنصر هو الذي سيتم تحويله إلى PDF -->
            <div id="all-students-pdf-content" class="pdf-page text-right">
                <!-- 1. الترويسة المخصصة (من الإعدادات) -->
                <div id="all-pdf-custom-header" class="mb-8">
                    <img id="all-pdf-header-image" src="" alt="" class="max-w-full h-auto mx-auto">
                </div>

                <!-- 2. معلومات التقرير -->
                <div class="mb-8 text-center">
                    <h1 class="text-3xl font-bold mb-4" style="color: #000;">تقرير نتائج جميع الطلاب</h1>
                    <p class="text-lg" style="color: #000;"><span class="font-semibold">تاريخ التصدير:</span> <span id="all-pdf-date"></span></p>
                </div>
                
                <!-- 3. جدول كل الطلاب -->
                <h2 class="text-2xl font-semibold mb-4" style="color: #000;">النتائج المجمعة</h2>
                <table class="w-full border-collapse border border-gray-400 text-base" style="color: #000;">
                    <thead class="bg-gray-200" style="background: #E5E7EB;">
                        <tr>
                            <th class="border border-gray-400 p-3 font-semibold">اسم الطالب</th>
                            <th class="border border-gray-400 p-3 font-semibold">الصف</th>
                            <th class="border border-gray-400 p-3 font-semibold">المتوسط النهائي (من 5)</th>
                            <th class="border border-gray-400 p-3 font-semibold">المقيمون</th>
                        </tr>
                    </thead>
                    <tbody id="all-students-pdf-table" class="bg-white">
                        <!-- سيتم ملء الصفوف هنا عبر JS -->
                    </tbody>
                </table>

                <!-- 4. لجنة التقييم (من الإعدادات) -->
                <div class="mt-12 pt-8 border-t-2 border-gray-300">
                    <h2 id="all-pdf-committee-title" class="text-xl font-semibold mb-4" style="color: #000;">لجنة التقييم</h2>
                    <ul id="all-pdf-evaluators-list" class="list-disc list-inside text-base" style="color: #000;">
                        <!-- سيتم ملء الأسماء هنا -->
                    </ul>
                </div>
            </div>
            
            <!-- أزرار التحكم بالمودال -->
            <div class="mt-6 flex items-center space-x-4 space-x-reverse no-print">
                <button id="confirmAllStudentsPdfDownload" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    تأكيد التنزيل (PDF)
                </button>
                <button id="cancelAllStudentsPdfPreview" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-all">
                    إلغاء
                </button>
            </div>
        </div>
    </div>


    <!-- ============================================= -->
    <!--          السكريبت الرئيسي للتطبيق             -->
    <!-- ============================================= -->
    <script type="module">
        // جلب المكتبات من CDN
        const { jsPDF } = window.jspdf;
        const html2canvas = window.html2canvas;

        // متغيرات الحالة العامة
        let currentStudentId = null;
        let currentEvaluator = null;
        let currentEvaluationDocId = null; // لتتبع هل نعدل تقييم حالي أم ننشئ جديد
        let cameFromEvaluation = false; // لتتبع الدخول للإعدادات

        // قاعدة البيانات المحلية (localStorage)
        let db = {
            students: [],
            evaluations: [],
            settings: {
                pdfImage: null,
                committeeTitle: "لجنة التقييم"
            }
        };

        // جلب العناصر الرئيسية من DOM
        const screens = {
            mainMenu: document.getElementById('mainMenuScreen'),
            registration: document.getElementById('registrationScreen'),
            password: document.getElementById('passwordScreen'),
            evaluationList: document.getElementById('evaluationListScreen'),
            rating: document.getElementById('ratingScreen'),
            settings: document.getElementById('settingsScreen')
        };
        const modals = {
            message: document.getElementById('messageModal'),
            pdfPreview: document.getElementById('pdfPreviewModal'),
            allStudentsPdf: document.getElementById('allStudentsPdfModal')
        };
        const backButtons = document.querySelectorAll('.backButton');
        const settingsButton = document.getElementById('settingsButton');

        // ===================================
        // وظائف إدارة البيانات (localStorage)
        // ===================================

        function loadData() {
            db.students = JSON.parse(localStorage.getItem('students')) || [];
            db.evaluations = JSON.parse(localStorage.getItem('evaluations')) || [];
            db.settings = JSON.parse(localStorage.getItem('settings')) || {
                pdfImage: null,
                committeeTitle: "لجنة التقييم"
            };
            console.log("تم تحميل البيانات من localStorage:", db);
        }

        function saveData() {
            localStorage.setItem('students', JSON.stringify(db.students));
            localStorage.setItem('evaluations', JSON.stringify(db.evaluations));
            localStorage.setItem('settings', JSON.stringify(db.settings));
            console.log("تم حفظ البيانات في localStorage");
        }

        function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // ===================================
        // وظائف التنقل بين الشاشات
        // ===================================

        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenId]) {
                screens[screenId].classList.remove('hidden');
            }
            // إخفاء زر الإعدادات في شاشة الإعدادات نفسها
            settingsButton.classList.toggle('hidden', screenId === 'settings');
        }

        // ===================================
        // وظائف المودال (الرسائل والمعاينة)
        // ===================================

        function showMessage(message, isError = false) {
            const modal = modals.message;
            const text = modal.querySelector('#messageText');
            const iconContainer = modal.querySelector('#messageIcon');
            
            text.textContent = message;
            
            if (isError) {
                iconContainer.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4';
                iconContainer.innerHTML = `<svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`;
            } else {
                iconContainer.className = 'mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4';
                iconContainer.innerHTML = `<svg class="h-6 w-6 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>`;
            }
            
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
            setTimeout(() => modal.querySelector('.modal-content').classList.remove('scale-95'), 10);
        }

        function hideMessage() {
            const modal = modals.message;
            modal.classList.add('opacity-0');
            modal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        
        function showModal(modalElement) {
            modalElement.classList.remove('hidden');
            setTimeout(() => modalElement.classList.remove('opacity-0'), 10);
            setTimeout(() => modalElement.querySelector('.modal-content').classList.remove('scale-95'), 10);
        }

        function hideModal(modalElement) {
            modalElement.classList.add('opacity-0');
            modalElement.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => modalElement.classList.add('hidden'), 300);
        }

        // ===================================
        // وظائف شاشة التسجيل
        // ===================================

        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const student = {
                id: uuidv4(),
                name: document.getElementById('studentName').value,
                class: document.getElementById('studentClass').value,
                section: document.getElementById('studentSection').value,
                department: document.getElementById('studentDepartment').value,
                group: document.getElementById('studentGroup').value,
                broadcastDate: document.getElementById('broadcastDate').value,
            };

            db.students.push(student);
            saveData();
            
            showMessage('تم تسجيل الطالب بنجاح!');
            document.getElementById('registrationForm').reset();
            showScreen('mainMenu');
        });

        // ===================================
        // وظائف شاشة كلمة المرور
        // ===================================

        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            
            if (password === '123') {
                cameFromEvaluation = true; // سجل أنه دخل من وحدة التقييم
                renderEvaluationList();
                showScreen('evaluationList');
                document.getElementById('passwordInput').value = '';
            } else {
                showMessage('كلمة المرور غير صحيحة. حاول مرة أخرى.', true);
            }
        });

        // ===================================
        // وظائف شاشة قائمة التقييم
        // ===================================

        function renderEvaluationList() {
            const container = document.getElementById('studentListContainer');
            
            if (db.students.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-center">لا يوجد طلاب مسجلون حتى الآن.</p>`;
                return;
            }
            
            container.innerHTML = ''; // أفرغ الحاوية
            
            db.students.forEach(student => {
                const studentCard = document.createElement('div');
                studentCard.className = 'flex flex-col md:flex-row items-center justify-between bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-200';
                
                studentCard.innerHTML = `
                    <div class="mb-4 md:mb-0">
                        <p class="text-lg font-bold text-gray-800">${student.name}</p>
                        <p class="text-sm text-gray-600">
                            الصف: ${student.class} / ${student.section} - القسم: ${student.department}
                        </p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button data-id="${student.id}" class="evalButton flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all">
                            تقييم
                        </button>
                        <button data-id="${student.id}" class="exportPdfButton flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all">
                            PDF
                        </button>
                        <button data-id="${student.id}" class="deleteButton flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all">
                            حذف
                        </button>
                    </div>
                `;
                container.appendChild(studentCard);
            });
        }

        // إضافة مستمعين لأزرار قائمة الطلاب (تفويض الأحداث)
        document.getElementById('studentListContainer').addEventListener('click', function(e) {
            const target = e.target.closest('button');
            if (!target) return;
            
            const studentId = target.dataset.id;
            
            if (target.classList.contains('evalButton')) {
                goToRatingScreen(studentId);
            } else if (target.classList.contains('exportPdfButton')) {
                showStudentPdfPreview(studentId);
            } else if (target.classList.contains('deleteButton')) {
                deleteStudent(studentId);
            }
        });
        
        // زر تصدير جميع الطلاب
        document.getElementById('exportAllStudentsButton').addEventListener('click', showAllStudentsPdfPreview);


        // ===================================
        // وظائف الحذف
        // ===================================

        function deleteStudent(studentId) {
            // ملاحظة: لا نستخدم confirm()‎، سنقوم بإنشاء مودال تأكيد بسيط.
            // ... (للبساطة الآن، سنحذف مباشرة)
            // (تحديث: بما أن confirm ممنوع، سنحذف مباشرة ونبلغ المستخدم)
            
            db.students = db.students.filter(s => s.id !== studentId);
            db.evaluations = db.evaluations.filter(e => e.studentId !== studentId); // حذف التقييمات المرتبطة
            
            saveData();
            renderEvaluationList(); // أعد رسم القائمة
            
            showMessage('تم حذف الطالب وجميع تقييماته بنجاح.');
        }

        // ===================================
        // وظائف شاشة التقييم التفصيلي
        // ===================================

        function goToRatingScreen(studentId) {
            currentStudentId = studentId;
            const student = db.students.find(s => s.id === studentId);
            if (!student) return;
            
            document.getElementById('ratingStudentName').textContent = student.name;
            
            // إعادة تعيين النموذج
            document.getElementById('evaluatorSelect').value = '';
            document.getElementById('ratingForm').classList.add('hidden');
            resetRatingForm();
            
            renderEvaluationHistory(studentId);
            showScreen('rating');
        }
        
        // عند اختيار اسم المقيم
        document.getElementById('evaluatorSelect').addEventListener('change', function(e) {
            currentEvaluator = e.target.value;
            if (currentEvaluator) {
                document.getElementById('ratingForm').classList.remove('hidden');
                loadPreviousEvaluation();
            } else {
                document.getElementById('ratingForm').classList.add('hidden');
            }
        });

        // تحميل التقييم السابق (إن وجد)
        function loadPreviousEvaluation() {
            resetRatingForm(); // ابدأ بإعادة تعيين النموذج

            const existingEval = db.evaluations.find(
                e => e.studentId === currentStudentId && e.evaluator === currentEvaluator
            );
            
            if (existingEval) {
                currentEvaluationDocId = existingEval.id; // وجدنا تقييم، سنقوم بتعديله
                
                // ملء النموذج بالبيانات المحفوظة
                selectRatingButton('prep', existingEval.scores.prep);
                selectRatingButton('diversity', existingEval.scores.diversity);
                selectRatingButton('clarity', existingEval.scores.clarity);
                selectRatingButton('delivery', existingEval.scores.delivery);
                
                showMessage('تم تحميل تقييمك السابق لهذا الطالب.');
            } else {
                currentEvaluationDocId = null; // لا يوجد تقييم، هذا تقييم جديد
            }
        }
        
        // مساعدة: إعادة تعيين نموذج التقييم
        function resetRatingForm() {
            document.querySelectorAll('.rating-button.selected').forEach(btn => {
                btn.classList.remove('selected', 'bg-blue-600', 'text-white');
            });
            document.querySelectorAll('#ratingForm input[type="hidden"]').forEach(input => {
                input.value = '';
            });
        }
        
        // مساعدة: تحديد زر التقييم
        function selectRatingButton(criteria, value) {
            const container = document.querySelector(`div[data-criteria="${criteria}"]`);
            if (!container) return;
            
            // إزالة الاختيار السابق
            container.querySelectorAll('.rating-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // إضافة الاختيار الجديد
            const button = container.querySelector(`button[data-value="${value}"]`);
            if (button) {
                button.classList.add('selected');
                document.getElementById(`${criteria}Score`).value = value;
            }
        }
        
        // مستمع نقرات لأزرار التقييم (تفويض الأحداث)
        document.getElementById('ratingForm').addEventListener('click', function(e) {
            const target = e.target.closest('.rating-button');
            if (!target) return;
            
            const criteria = target.parentElement.dataset.criteria;
            const value = target.dataset.value;
            
            selectRatingButton(criteria, value);
        });

        // حفظ التقييم
        document.getElementById('ratingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const scores = {
                prep: document.getElementById('prepScore').value,
                diversity: document.getElementById('diversityScore').value,
                clarity: document.getElementById('clarityScore').value,
                delivery: document.getElementById('deliveryScore').value,
            };

            // التحقق من اكتمال التقييم
            if (Object.values(scores).some(score => !score)) {
                showMessage('الرجاء تقييم جميع المعايير الأربعة.', true);
                return;
            }

            const evaluationData = {
                studentId: currentStudentId,
                evaluator: currentEvaluator,
                scores: {
                    prep: parseInt(scores.prep),
                    diversity: parseInt(scores.diversity),
                    clarity: parseInt(scores.clarity),
                    delivery: parseInt(scores.delivery),
                },
                date: new Date().toISOString(),
            };

            if (currentEvaluationDocId) {
                // تحديث تقييم موجود
                const index = db.evaluations.findIndex(e => e.id === currentEvaluationDocId);
                if (index > -1) {
                    db.evaluations[index] = { ...db.evaluations[index], ...evaluationData, id: currentEvaluationDocId };
                }
            } else {
                // إضافة تقييم جديد
                evaluationData.id = uuidv4();
                db.evaluations.push(evaluationData);
                currentEvaluationDocId = evaluationData.id; // تحديث الـ ID لعمليات الحفظ التالية
            }

            saveData();
            showMessage('تم حفظ التقييم بنجاح!');
            renderEvaluationHistory(currentStudentId); // تحديث السجل
        });

        // عرض سجل التقييمات
        function renderEvaluationHistory(studentId) {
            const container = document.getElementById('historyTableContainer');
            const history = db.evaluations
                .filter(e => e.studentId === studentId)
                .sort((a, b) => new Date(b.date) - new Date(a.date)); // الأحدث أولاً

            if (history.length === 0) {
                container.innerHTML = '<p class="text-gray-500">لا يوجد تقييمات سابقة لهذا الطالب.</p>';
                return;
            }
            
            let tableHTML = `
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                        <tr>
                            <th scope="col" class="px-6 py-3">المقيّم</th>
                            <th scope="col" class="px-6 py-3">المتوسط</th>
                            <th scope="col" class="px-6 py-3">التاريخ</th>
                            <th scope="col" class="px-6 py-3">تفاصيل</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            history.forEach(eval_ => {
                const s = eval_.scores;
                const avg = ((s.prep + s.diversity + s.clarity + s.delivery) / 4).toFixed(1);
                const date = new Date(eval_.date).toLocaleDateString('ar-EG');
                
                const details = `
                    الإعداد: ${s.prep} |
                    التنوع: ${s.diversity} |
                    الوضوح: ${s.clarity} |
                    الإلقاء: ${s.delivery}
                `.trim();

                tableHTML += `
                    <tr class="bg-white border-b hover:bg-gray-50">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${eval_.evaluator}</th>
                        <td class="px-6 py-4">${avg} / 5</td>
                        <td class="px-6 py-4">${date}</td>
                        <td class="px-6 py-4 text-xs">${details}</td>
                    </tr>
                `;
            });
            
            tableHTML += `</tbody></table>`;
            container.innerHTML = tableHTML;
        }

        // زر الرجوع من شاشة التقييم إلى القائمة
        document.getElementById('backToListButton').addEventListener('click', () => {
            renderEvaluationList();
            showScreen('evaluationList');
        });

        // ===================================
        // وظائف شاشة الإعدادات
        // ===================================

        function showSettingsScreen() {
            // ملء الحقول بالبيانات المحفوظة
            document.getElementById('settingsCommitteeTitle').value = db.settings.committeeTitle;
            const preview = document.getElementById('settingsImagePreview');
            if (db.settings.pdfImage) {
                preview.src = db.settings.pdfImage;
            } else {
                preview.src = "https://placehold.co/600x150/EEE/CCC?text=Preview";
            }
            
            // إظهار/إخفاء قسم تصدير التطبيق
            if (cameFromEvaluation) {
                document.getElementById('appSettingsSection').classList.remove('hidden');
            } else {
                document.getElementById('appSettingsSection').classList.add('hidden');
            }
            
            showScreen('settings');
        }

        // مستمع زر الإعدادات الرئيسي
        settingsButton.addEventListener('click', showSettingsScreen);

        // حفظ الإعدادات
        document.getElementById('saveSettingsButton').addEventListener('click', () => {
            db.settings.committeeTitle = document.getElementById('settingsCommitteeTitle').value;
            // الصورة تم حفظها تلقائياً عند التغيير (انظر أدناه)
            saveData();
            showMessage('تم حفظ الإعدادات بنجاح.');
        });
        
        // مستمع تغيير صورة الإعدادات
        document.getElementById('settingsPdfImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onloadend = function() {
                const base64String = reader.result;
                db.settings.pdfImage = base64String;
                document.getElementById('settingsImagePreview').src = base64String;
                saveData(); // حفظ تلقائي عند رفع الصورة
                showMessage('تم حفظ الصورة.');
            }
            reader.readAsDataURL(file);
        });

        // ===================================
        // وظائف تصدير التطبيق (HTML)
        // ===================================

        document.getElementById('exportAppButton').addEventListener('click', function() {
            // لا نحتاج لتضمين البيانات لأنها محفوظة في localStorage
            // سنقوم فقط بتنزيل ملف HTML الحالي
            
            try {
                // نسخ محتوى الصفحة الحالي
                const htmlContent = document.documentElement.outerHTML;
                
                // إنشاء Blob
                const blob = new Blob([htmlContent], { type: 'text/html' });
                
                // إنشاء رابط تنزيل
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'تطبيق_تقييم_الطلاب.html'; // اسم الملف
                document.body.appendChild(a);
                a.click();
                
                // تنظيف
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
                
                showMessage('تم بدء تنزيل التطبيق كملف HTML.');
                
            } catch (error) {
                console.error("خطأ في تصدير HTML:", error);
                showMessage('حدث خطأ أثناء محاولة تصدير التطبيق.', true);
            }
        });

        // ===================================
        // وظائف تصدير PDF (طالب واحد)
        // ===================================

        // دالة المساعدة لحساب النتيجة النهائية (الأغلبية أو عشوائي)
        function calculateFinalScore(scoresArray) {
            if (!scoresArray || scoresArray.length === 0) return 0;
            
            const counts = {};
            scoresArray.forEach(score => {
                counts[score] = (counts[score] || 0) + 1;
            });

            let majorityScore = null;
            let maxCount = 1;
            
            for (const score in counts) {
                if (counts[score] > maxCount) {
                    maxCount = counts[score];
                    majorityScore = parseInt(score);
                }
            }

            if (maxCount > 1) {
                // يوجد أغلبية (حتى لو 2 من 3)
                return majorityScore;
            } else {
                // لا يوجد أغلبية (كلهم مختلفون)
                // نختار عشوائياً واحد منهم
                return scoresArray[Math.floor(Math.random() * scoresArray.length)];
            }
        }
        
        const scoreLevels = { 5: 'ممتاز', 4: 'جيد جداً', 3: 'جيد', 2: 'مقبول', 1: 'ضعيف' };
        const criteriaNames = { prep: 'الإعداد الجيد', diversity: 'التنوع', clarity: 'وضوح الرسالة الموجهة', delivery: 'جودة الإلقاء' };

        function showStudentPdfPreview(studentId) {
            const student = db.students.find(s => s.id === studentId);
            const evaluations = db.evaluations.filter(e => e.studentId === studentId);
            
            if (!student) return;

            // 1. ملء معلومات الطالب والترويسة
            document.getElementById('pdf-date').textContent = new Date().toLocaleDateString('ar-EG');
            document.getElementById('pdf-student-name').textContent = student.name;
            document.getElementById('pdf-student-department').textContent = student.department;
            document.getElementById('pdf-student-class').textContent = `الصف ${student.class} / ${student.section}`;
            document.getElementById('pdf-student-group').textContent = student.group;
            
            // 2. تحميل صورة الترويسة من الإعدادات
            const headerImg = document.getElementById('pdf-header-image');
            if (db.settings.pdfImage) {
                headerImg.src = db.settings.pdfImage;
                headerImg.classList.remove('hidden');
            } else {
                headerImg.src = "";
                headerImg.classList.add('hidden');
            }

            // 3. حساب النتائج النهائية
            const finalScores = {};
            const criteriaKeys = ['prep', 'diversity', 'clarity', 'delivery'];
            
            criteriaKeys.forEach(key => {
                const scores = evaluations.map(e => e.scores[key]).filter(s => s); // [5, 4, 5]
                finalScores[key] = calculateFinalScore(scores); // 5
            });

            // 4. رسم جدول النتائج
            const tableBody = document.getElementById('pdf-scores-table');
            tableBody.innerHTML = '';
            
            criteriaKeys.forEach(key => {
                const finalScore = finalScores[key]; // 5
                const row = document.createElement('tr');
                
                let cells = `<td class="border border-gray-400 p-3 font-semibold" style="color: #000;">${criteriaNames[key]}</td>`;
                for (let i = 5; i >= 1; i--) {
                    cells += `
                        <td class="border border-gray-400 p-3 text-center" style="color: #000;">
                            ${finalScore === i ? '<span class="text-green-600 font-bold text-xl">✓</span>' : ''}
                        </td>
                    `;
                }
                row.innerHTML = cells;
                tableBody.appendChild(row);
            });
            
            // 5. ملء لجنة التقييم
            document.getElementById('pdf-committee-title').textContent = db.settings.committeeTitle || "لجنة التقييم";
            const evaluatorsList = document.getElementById('pdf-evaluators-list');
            evaluatorsList.innerHTML = '';
            const evaluatorNames = [...new Set(evaluations.map(e => e.evaluator))]; // أسماء فريدة
            
            if (evaluatorNames.length > 0) {
                evaluatorNames.forEach(name => {
                    evaluatorsList.innerHTML += `<li style="color: #000;">${name}</li>`;
                });
            } else {
                evaluatorsList.innerHTML = `<li style="color: #000;">لا توجد تقييمات مسجلة</li>`;
            }
            
            // 6. ربط زر التحميل
            modals.pdfPreview.querySelector('#confirmPdfDownload').onclick = () => {
                generatePdf('pdf-preview-content', `report_${student.name.replace(/ /g, '_')}.pdf`);
            };

            // 7. إظهار المودال
            showModal(modals.pdfPreview);
        }

        // ===================================
        // وظائف تصدير PDF (كل الطلاب)
        // ===================================

        function showAllStudentsPdfPreview() {
            const evaluatedStudents = db.students.filter(student => 
                db.evaluations.some(e => e.studentId === student.id)
            );

            // 1. ملء معلومات التقرير والترويسة
            document.getElementById('all-pdf-date').textContent = new Date().toLocaleDateString('ar-EG');
            const headerImg = document.getElementById('all-pdf-header-image');
            if (db.settings.pdfImage) {
                headerImg.src = db.settings.pdfImage;
                headerImg.classList.remove('hidden');
            } else {
                headerImg.src = "";
                headerImg.classList.add('hidden');
            }

            // 2. ملء جدول الطلاب
            const tableBody = document.getElementById('all-students-pdf-table');
            tableBody.innerHTML = '';
            
            let allEvaluators = new Set(); // لجمع كل المقيمين

            evaluatedStudents.forEach(student => {
                const evaluations = db.evaluations.filter(e => e.studentId === student.id);
                if (evaluations.length === 0) return;
                
                let totalSum = 0;
                let totalCount = 0;
                let studentEvaluators = new Set();
                
                evaluations.forEach(e => {
                    totalSum += e.scores.prep + e.scores.diversity + e.scores.clarity + e.scores.delivery;
                    totalCount += 4; // 4 معايير
                    studentEvaluators.add(e.evaluator);
                    allEvaluators.add(e.evaluator);
                });
                
                const finalAverage = ((totalSum / totalCount) * 5).toFixed(1); // تحويل النتيجة لنسبة من 5
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-400 p-3 font-semibold" style="color: #000;">${student.name}</td>
                    <td class="border border-gray-400 p-3" style="color: #000;">${student.class} / ${student.section}</td>
                    <td class="border border-gray-400 p-3 text-center font-bold" style="color: #000;">${finalAverage}</td>
                    <td class="border border-gray-400 p-3 text-xs" style="color: #000;">${[...studentEvaluators].join(', ')}</td>
                `;
                tableBody.appendChild(row);
            });

            // 3. ملء لجنة التقييم
            document.getElementById('all-pdf-committee-title').textContent = db.settings.committeeTitle || "لجنة التقييم";
            const evaluatorsList = document.getElementById('all-pdf-evaluators-list');
            evaluatorsList.innerHTML = '';
            
            if (allEvaluators.size > 0) {
                allEvaluators.forEach(name => {
                    evaluatorsList.innerHTML += `<li style="color: #000;">${name}</li>`;
                });
            } else {
                evaluatorsList.innerHTML = `<li style="color: #000;">لا توجد تقييمات مسجلة</li>`;
            }
            
            // 4. ربط زر التحميل
            modals.allStudentsPdf.querySelector('#confirmAllStudentsPdfDownload').onclick = () => {
                generatePdf('all-students-pdf-content', 'all_students_report.pdf');
            };

            // 5. إظهار المودال
            showModal(modals.allStudentsPdf);
        }

        // ===================================
        // وظيفة التصدير إلى PDF (الأساسية)
        // ===================================

        async function generatePdf(elementId, fileName) {
            const elementToCapture = document.getElementById(elementId);
            
            if (!elementToCapture) {
                console.error("العنصر غير موجود:", elementId);
                showMessage('خطأ: العنصر المراد طباعته غير موجود.', true);
                return;
            }

            showMessage('جاري إعداد ملف PDF، يرجى الانتظار...');

            try {
                // استخدام html2canvas لالتقاط العنصر
                const canvas = await html2canvas(elementToCapture, {
                    scale: 2, // دقة أعلى
                    useCORS: true, // للسماح بتحميل الصور (مثل الترويسة)
                    backgroundColor: '#ffffff', // خلفية بيضاء
                });
                
                const imgData = canvas.toDataURL('image/png');
                
                // حساب أبعاد الـ PDF
                const pdf = new jsPDF('p', 'mm', 'a4'); // A4 portrait
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                const imgProps = pdf.getImageProperties(imgData);
                const imgWidth = pdfWidth;
                const imgHeight = (imgProps.height * imgWidth) / imgProps.width;

                let heightLeft = imgHeight;
                let position = 0;

                // إضافة الصفحة الأولى
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pdfHeight;

                // إضافة صفحات إضافية إذا كانت الصورة أطول من صفحة A4
                while (heightLeft > 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }
                
                // حفظ الملف
                pdf.save(fileName);
                
                hideMessage(); // إخفاء رسالة "جاري الإعداد"
                hideModal(modals.pdfPreview); // إخفاء المودال بعد النجاح
                hideModal(modals.allStudentsPdf);

            } catch (error) {
                console.error("خطأ أثناء إنشاء PDF:", error);
                showMessage('حدث خطأ فني أثناء إنشاء ملف PDF.', true);
            }
        }


        // ===================================
        // تهيئة التطبيق عند البدء
        // ===================================

        function initializeApp() {
            // تحميل البيانات المحفوظة
            loadData();
            
            // إعداد مستمعي الأحداث
            document.getElementById('goToRegistrationButton').addEventListener('click', () => showScreen('registration'));
            document.getElementById('goToPasswordButton').addEventListener('click', () => showScreen('password'));
            
            backButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // تحديد إلى أين نرجع
                    if (screens.evaluationList.classList.contains('hidden')) {
                        showScreen('mainMenu'); // رجوع عام
                    } else {
                        renderEvaluationList();
                        showScreen('evaluationList'); // رجوع من الإعدادات إلى قائمة التقييم
                    }
                    cameFromEvaluation = false; // إعادة تعيين الحالة
                });
            });

            document.getElementById('closeMessageButton').addEventListener('click', hideMessage);
            document.getElementById('cancelPdfPreview').addEventListener('click', () => hideModal(modals.pdfPreview));
            document.getElementById('cancelAllStudentsPdfPreview').addEventListener('click', () => hideModal(modals.allStudentsPdf));

            // عرض الشاشة الرئيسية
            showScreen('mainMenu');
        }

        // بدء تشغيل التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>


</body></html>